<div 
    class="invoice-view-container view-container"
    ng-init="initInvoice()"
>
    <div format-addresses address="invoice.billingAddress"></div>
    <div format-addresses address="invoice.clientAddress"></div>
    <div format-clients client="invoice.Client"></div>
    <div format-phone-numbers phone-number="invoice.clientPhoneNumber"></div>
    <div 
        class="callout sticky text-center fade"
        ng-hide="!UI.message.length &&
        !UI.errMessage.length || 
        UI.modalFormSaved"
        ng-if="UI.invoiceView"
        ng-class="{'success success-text': UI.message,
        'alert alert-text': UI.errMessage}"
        data-sticky 
        data-options="marginTop:0;"
    >
        <button 
            class="close-button button clear"
            ng-class="{'success': UI.message,
            'alert': UI.errMessage}"
            type="button"
            ng-click="UI.errMessage = !UI.errMessage;
            UI.message = !UI.message"
        >
            <i class="fal fa-times-circle"></i>
        </button>
        <p ng-if="UI.message.length">
            {{UI.message}}
        </p>
        <p ng-if="UI.errMessage.length">
            {{UI.errMessage}}
        </p>
    </div>
    <div class="invoice-view view">
        <div class="grid-y grid-container">
            <div class="cell shrink">
                <div class="grid-x">
                    <div 
                        class="small-12 medium-shrink large-shrink"
                        ng-if="UI.invoiceView"
                    >
                        <button 
                            class="back-button button warning white-text" 
                            type="button"
                            ng-click="$root.goBack()"
                        >
                            <i class="fal fa-circle-arrow-left"></i> Back
                        </button>
                        <button
                            class="invoice-options-button button float-right"
                            type="button"
                            ng-click="toggleInvoiceOptions()"
                            data-open="viewInvoiceOptionsReveal"
                            ng-if="$root.UI.isMobile"
                        >      
                            <i class="fal fa-cog"></i> 
                        </button>
                    </div>
                    <div 
                        class="small-12 medium-auto large-auto"
                        ng-if="!$root.UI.isMobile"
                    >
                        <div ng-include="'/dist/partials/invoices/top-bar.html'"></div>
                    </div>
                </div>
            </div>
            <div class="cell shrink">
                <div class="invoice-view-total-container invoice-view-item-container view-details-container">
                    <h2>
                        <b>
                            {{invoice.invoiceNumber}}
                        </b>
                    </h2>
                    <h6>
                        <b>
                            Sub Total: 
                        </b>
                        <span ng-if="invoice.subTotal">
                            ${{invoice.subTotal | number}}
                        </span>
                        <span ng-if="!invoice.subTotal">
                            $0.00
                        </span>
                    </h6>
                    <h6>
                        <b>
                            Discounts Total: 
                        </b>
                        <span ng-if="invoice.discountTotal">
                            -{{invoice.discountTotal | number}}
                        </span>
                        <span ng-if="!invoice.discountTotal">
                            - $0.00
                        </span>
                    </h6>
                    <h6>
                       <b>
                            Total: 
                       </b>
                        <span ng-if="invoice.total">
                            ${{invoice.total | number}}
                        </span>
                        <span ng-if="!invoice.total">
                            $0.00
                        </span>
                    </h6>
                    <h6>
                        <b>
                            Billing Address: 
                        </b>
                        <span ng-if="invoice.total">
                            {{invoice.billingAddress.fullAddress}}
                        </span>
                    </h6>
                </div>
            </div>
            <div class="cell shrink">
                <div class="invoice-view-client-container invoice-view-item-container view-details-container">
                    <h2>
                        <b>
                            Client
                        </b>
                    </h2>
                    <div class="invoice-view-client">
                        <h4>
                            <a
                                class="client-name-link"
                                ng-href="/clients/client/{{invoice.Client.id}}"
                                ng-if="invoice.Client.id"
                            >
                                <b>
                                    {{invoice.Client.fullName}}
                                </b>
                            </a>
                        </h4>
                        <h6>
                            <b>Email:</b> {{invoice.clientEmail.email}}
                        </h6>
                        <h6>
                            <b>Phone:</b> {{invoice.clientPhoneNumber.formattedNumber}}
                        </h6>
                        <h6>
                            <b>Address:</b> {{invoice.clientAddress.fullAddress}}
                        </h6>
                    </div>
                </div>
            </div>
            <div class="cell shrink">
                <div class="invoice-view-memo-container invoice-view-item-container view-details-container">
                    <h2>
                        <b>
                            Memo
                        </b>
                    </h2>
                    <div 
                        class="invoice-view-memo"
                        ng-bind-html="invoice.memo"
                    ></div>
                </div>
            </div>
            <div class="cell shrink">
                <div class="invoice-view-line-items-container invoice-view-item-container view-details-container list-container">
                    <h2>
                        <b>
                            Line Items
                        </b>
                    </h2>
                    <ul 
                        class="line-items-list list"
                        id="lineItemsList"
                    >
                        <li ng-if="!UI.invoiceLoaded">
                            <div class="ssc line-items-ssc">
                                <div 
                                    class="ssc-square"
                                    ng-repeat="x in [].constructor(40) track by $index"
                                ></div>
                            </div>
                        </li>
                        <li
                            class="line-items-list-item list-item position-relative"
                            ng-repeat="l in invoice.InvoiceLineItems track by $index"
                        >
                            <div class="grid-x grid-padding-x align-middle">
                                <div class="cell small-12 medium-auto large-auto">
                                    <h6 class="line-items-list-item-name">
                                        <b>
                                            {{l.name}}
                                        </b>
                                    </h6>
                                </div>
                                <div 
                                    class="cell small-12 medium-shrink large-shrink"
                                    ng-if="invoice.lineItemPrice"
                                >
                                    <h6>
                                        ${{l.totalPrice | number}}
                                    </h6>
                                </div>
                                <div class="cell small-12 medium-12 large-12">
                                    <p ng-bind="l.description"></p>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="cell shrink">
                <div class="invoice-view-discounts-container invoice-view-item-container view-details-container list-container">
                    <h2>
                        <b>
                            Discounts
                        </b>
                    </h2>
                    <ul class="invoice-view-discounts-list list">
                        <li 
                            class="invoice-view-discounts-list-item"
                            ng-repeat="discount in invoice.discounts track by $index"
                        >
                            <div class="grid-x grid-padding-x align-middle">
                                <div class="cell small-12 medium-auto large-auto">
                                    <h6 class="line-items-list-item-name">
                                        {{discount.name}}
                                    </h6>
                                </div>
                                <div class="cell small-12 medium-shrink large-shrink">
                                    <h6>
                                        ${{discount.total | number}}
                                    </h6>
                                </div>
                            </div>
                        </li>
                        <li 
                            class="text-center"
                            ng-if="!invoice.discounts.length"
                        >
                            <h6>
                                <b>
                                    None Applied
                                </b>
                            </h6>
                        </li>
                    </ul>
                </div>
            </div>
            <div 
                class="cell shrink"
                ng-show="UI.signatureLoaded && UI.invoiceView"
            >
                <div class="invoice-view-signature-container invoice-view-item-container view-details-container">
                    <h2>
                        <b>
                            Signature
                        </b>
                    </h2>
                    <h6 
                        class="text-center"
                        ng-if="!invoice.InvoiceSignature && !invoice.converted" 
                    >
                        <b>Sign Below</b>
                    </h6>
                    <h6 
                        class="text-center"
                        ng-if="invoice.InvoiceSignature" 
                    >
                        <b>
                            This invoice has been sign!
                        </b>
                        <br/>
                        Scroll up to pay a deposit if it hasn't already been paid!
                    </h6>
                    <h4
                        class="text-center"
                        ng-if="invoice.converted && !invoice.InvoiceSignature"
                    >
                        <b>
                            This invoice has been converted to a Invoice! Without a signature!
                            <br/>
                        </b>
                    </h4>
                    <div class="view-invoice-button-container text-center">
                        <button 
                            class="view-invoice-button button success white-text"
                            type="button"
                            ng-if="invoice.converted && !invoice.InvoiceSignature"
                        >
                            <i class="fal fa-search"></i> View Invoice
                        </button>
                    </div>
                    <div 
                        class="invoice-signature-pad-container"
                        ng-if="!invoice.InvoiceSignature && !invoice.converted ||
                        invoice.InvoiceSignature"
                    >
                        <canvas     
                            id="invoiceSignaturePad" 
                            class="invoice-signature-pad"
                            width="600" 
                            height="300"
                        ></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div
    class="invoice-terms-and-conditions-reveal reveal"
    id="invoiceTermsAndConditionsReveal"
    data-reveal
    data-close-on-click="false"
>
    <button 
        class="close-button" 
        aria-label="closeInvoiceTermsAndConditionsReveal" 
        type="button" 
        data-close
    >
        <span aria-hidden="true">
            <i class="fal fa-times-circle"></i>
        </span>
    </button>
    <div ng-bind-html="invoice.invoiceTermsAndConditions"></div>
    <div class="button-group align-right">
        <button 
            class="invoice-view-signature-save-button button warning white-text"
            type="button"
            data-close
        >
            <i class="fal fa-times-circle"></i> Cancel
        </button>
        <button 
            class="invoice-view-signature-save-button button success white-text" 
            type="button"
            ng-click="acceptTerms()"
        >
            <i class="fal fa-save"></i> Accept Terms & Continue
        </button>
    </div>
</div>
<div 
    class="view-invoice-options-mobile-reveal view-options-mobile-reveal reveal large"
    id="viewInvoiceOptionsReveal"
    data-reveal
    data-close-on-click="false"
>
    <button 
        class="close-button" 
        aria-label="closeViewInvoiceOptionsMobileReveal" 
        type="button" 
        data-close
    >
        <span aria-hidden="true">
            <i class="fal fa-times-circle"></i>
        </span>
    </button>
    <div class="view-invoice-options-mobile golura-block">
        <div ng-include="'/dist/partials/invoices/top-bar.html'"></div>
    </div>
</div>
<div
    class="invoice-payment-reveal reveal"
    id="invoicePaymentReveal"
    data-reveal
    data-close-on-click="false"
>
    <button 
        class="close-button" 
        aria-label="closeInvoicePaymentReveal" 
        type="button" 
        data-close
    >
        <span aria-hidden="true">
            <i class="fal fa-times-circle"></i>
        </span>
    </button>
    <div ng-include="'/dist/forms/payments/payment-method-form.html'"></div>
</div>